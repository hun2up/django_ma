{# django_ma/commission/templates/commission/deposit_home.html #}
{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load commission_extras %}

{% block title %}채권관리{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="mx-auto" style="max-width: 1100px;">
    <div
      id="deposit-home"
      class="card shadow p-4 border-0 rounded-4"
      data-user-detail-url="/commission/api/user-detail/"
      data-deposit-summary-url="/commission/api/deposit-summary/"
      data-deposit-surety-url="{% url 'commission:api_deposit_surety_list' %}"
      data-deposit-other-url="{% url 'commission:api_deposit_other_list' %}"
      data-reset-url="/commission/deposit/"
      data-support-pdf-url="{% url 'commission:api_support_pdf' %}"
    >
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold mb-0" style="color:#003f7d;">채권현황</h5>
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#searchUserModal">대상자검색</button>
          <button type="button" id="resetUserBtn" class="btn btn-outline-secondary btn-sm">초기화</button>
          <button type="button" id="supportPdfBtn" class="btn btn-success btn-sm" disabled>지원신청서</button>
        </div>
      </div>

      <!-- ✅ 인적사항 -->
      <div class="card shadow-sm border-0 rounded-4 my-3">
        <div class="card-body p-3 p-md-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-bold" style="color:#000000;">인적사항</div>
          </div>

          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th class="text-nowrap">사번</th>
                  <th class="text-nowrap">성명</th>
                  <th class="text-nowrap">부서</th>
                  <th class="text-nowrap">소속</th>
                  <th class="text-nowrap">입사일</th>
                  <th class="text-nowrap">퇴사일</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="target_emp_id" data-bind="target.id">{% if target %}{{ target.id }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap fw-semibold"><span id="target_name" data-bind="target.name">{% if target %}{{ target.name }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="target_part" data-bind="target.part">{% if target %}{{ target.part|default:"-" }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="target_branch" data-bind="target.branch">{% if target %}{{ target.branch|default:"-" }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="target_join_date" data-bind="target.join_date_display">{% if target %}{{ target.join_date_display }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="target_retire_date" data-bind="target.retire_date_display">{% if target %}{{ target.retire_date_display }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ✅ 주요지표 -->
      <div class="card shadow-sm border-0 rounded-4 my-3">
        <div class="card-body p-3 p-md-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-bold" style="color:#000000;">주요지표</div>
          </div>

          <div class="table-responsive mb-3">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">최종지급액</th>
                  <th scope="col" class="text-nowrap">장기총실적</th>
                  <th scope="col" class="text-nowrap">환수예상</th>
                  <th scope="col" class="text-nowrap">지급예상</th>
                  <th scope="col" class="text-nowrap">손생합산통산</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_final_payment" data-bind="summary.final_payment" data-type="money">{% if payment %}{{ payment|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_sales_total" data-bind="summary.sales_total" data-type="money">{% if sales_total %}{{ sales_total|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_refund_expected" data-bind="summary.refund_expected" data-type="money">{% if refund_expected %}{{ refund_expected|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_pay_expected" data-bind="summary.pay_expected" data-type="money">{% if pay_expected %}{{ pay_expected|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_maint_total" data-bind="summary.maint_total">{% if maint_total %}{{ maint_total }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="table-responsive mb-3">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">채권합계</th>
                  <th scope="col" class="text-nowrap">보증합계</th>
                  <th scope="col" class="text-nowrap">기타합계</th>
                  <th scope="col" class="text-nowrap">필요채권</th>
                  <th scope="col" class="text-nowrap">최종초과금액</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_debt_total" data-bind="summary.debt_total" data-type="money">{% if debt_total %}{{ debt_total|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_surety_total" data-bind="summary.surety_total" data-type="money">{% if surety_total %}{{ surety_total|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_other_total" data-bind="summary.other_total" data-type="money">{% if other_total %}{{ other_total|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_required_debt" data-bind="summary.required_debt" data-type="money">{% if required_debt %}{{ required_debt|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_final_excess_amount" data-bind="summary.final_excess_amount" data-type="money">{% if final_excess_amount %}{{ final_excess_amount|intcomma }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="table-responsive mb-3">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">1개월전분급</th>
                  <th scope="col" class="text-nowrap">2개월전분급</th>
                  <th scope="col" class="text-nowrap">3개월전분급</th>
                  <th scope="col" class="text-nowrap">당월인정계속분</th>
                  <th scope="col" class="text-nowrap">전월인정계속분</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_div_1m" data-bind="summary.div_1m">{% if div_1m %}{{ div_1m }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_div_2m" data-bind="summary.div_2m">{% if div_2m %}{{ div_2m }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_div_3m" data-bind="summary.div_3m">{% if div_3m %}{{ div_3m }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_inst_current" data-bind="summary.inst_current" data-type="money">{% if inst_current %}{{ inst_current|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_inst_prev" data-bind="summary.inst_prev" data-type="money">{% if inst_prev %}{{ inst_prev|intcomma }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {# ✅ 수수료현황 #}
      <div class="card shadow-sm border-0 rounded-4 my-3">
        <div class="card-body p-3 p-md-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-bold" style="color:#000000;">수수료현황</div>
          </div>

          <div class="table-responsive mb-3">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">환수손보</th>
                  <th scope="col" class="text-nowrap">환수생보</th>
                  <th scope="col" class="text-nowrap">지급손보</th>
                  <th scope="col" class="text-nowrap">지급생보</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_refund_ns" data-bind="summary.refund_ns" data-type="money">{% if refund_ns %}{{ refund_ns|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_refund_ls" data-bind="summary.refund_ls" data-type="money">{% if refund_ls %}{{ refund_ls|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_pay_ns" data-bind="summary.pay_ns" data-type="money">{% if pay_ns %}{{ pay_ns|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_pay_ls" data-bind="summary.pay_ls" data-type="money">{% if pay_ls %}{{ pay_ls|intcomma }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-12 col-lg-6">
              <div class="table-responsive">
                <table class="table table-sm align-middle mb-0 info-table">
                  <thead>
                    <tr>
                      <th class="text-nowrap">보증(O) 환수손보</th>
                      <th class="text-nowrap">보증(O) 환수생보</th>
                      <th class="text-nowrap">보증(O) 환수합계</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-nowrap"><span id="metric_surety_o_refund_ns" data-bind="summary.surety_o_refund_ns" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_o_refund_ls" data-bind="summary.surety_o_refund_ls" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_o_refund_total" data-bind="summary.surety_o_refund_total" data-type="money">-</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="col-12 col-lg-6">
              <div class="table-responsive">
                <table class="table table-sm align-middle mb-0 info-table">
                  <thead>
                    <tr>
                      <th class="text-nowrap">보증(O) 지급손보</th>
                      <th class="text-nowrap">보증(O) 지급생보</th>
                      <th class="text-nowrap">보증(O) 지급합계</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-nowrap"><span id="metric_surety_o_pay_ns" data-bind="summary.surety_o_pay_ns" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_o_pay_ls" data-bind="summary.surety_o_pay_ls" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_o_pay_total" data-bind="summary.surety_o_pay_total" data-type="money">-</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="col-12 col-lg-6">
              <div class="table-responsive">
                <table class="table table-sm align-middle mb-0 info-table">
                  <thead>
                    <tr>
                      <th class="text-nowrap">보증(X) 환수손보</th>
                      <th class="text-nowrap">보증(X) 환수생보</th>
                      <th class="text-nowrap">보증(X) 환수합계</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-nowrap"><span id="metric_surety_x_refund_ns" data-bind="summary.surety_x_refund_ns" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_x_refund_ls" data-bind="summary.surety_x_refund_ls" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_x_refund_total" data-bind="summary.surety_x_refund_total" data-type="money">-</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="col-12 col-lg-6">
              <div class="table-responsive">
                <table class="table table-sm align-middle mb-0 info-table">
                  <thead>
                    <tr>
                      <th class="text-nowrap">보증(X) 지급손보</th>
                      <th class="text-nowrap">보증(X) 지급생보</th>
                      <th class="text-nowrap">보증(X) 지급합계</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-nowrap"><span id="metric_surety_x_pay_ns" data-bind="summary.surety_x_pay_ns" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_x_pay_ls" data-bind="summary.surety_x_pay_ls" data-type="money">-</span></td>
                      <td class="text-nowrap"><span id="metric_surety_x_pay_total" data-bind="summary.surety_x_pay_total" data-type="money">-</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">3개월총수수료</th>
                  <th scope="col" class="text-nowrap">6개월총수수료</th>
                  <th scope="col" class="text-nowrap">9개월총수수료</th>
                  <th scope="col" class="text-nowrap">12개월총수수료</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_comm_3m" data-bind="summary.comm_3m" data-type="money">{% if comm_3m %}{{ comm_3m|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_comm_6m" data-bind="summary.comm_6m" data-type="money">{% if comm_6m %}{{ comm_6m|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_comm_9m" data-bind="summary.comm_9m" data-type="money">{% if comm_9m %}{{ comm_9m|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_comm_12m" data-bind="summary.comm_12m" data-type="money">{% if comm_12m %}{{ comm_12m|intcomma }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>

      <!-- ✅ 유지율/수금율 -->
      <div class="card shadow-sm border-0 rounded-4 my-3">
        <div class="card-body p-3 p-md-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-bold" style="color:#000000;">유지율/수금율</div>
          </div>

          <!-- ✅ 회차유지율 -->
          <div class="table-responsive mb-3">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">13회손보회차</th>
                  <th scope="col" class="text-nowrap">18회손보회차</th>
                  <th scope="col" class="text-nowrap">13회생보회차</th>
                  <th scope="col" class="text-nowrap">18회생보회차</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_ns_13_round" data-bind="summary.ns_13_round" data-type="percent">{% if ns_13_round %}{{ ns_13_round|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ns_18_round" data-bind="summary.ns_18_round" data-type="percent">{% if ns_18_round %}{{ ns_18_round|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ls_13_round" data-bind="summary.ls_13_round" data-type="percent">{% if ls_13_round %}{{ ls_13_round|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ls_18_round" data-bind="summary.ls_18_round" data-type="percent">{% if ls_18_round %}{{ ls_18_round|intcomma }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- ✅ 통산유지율 -->
          <div class="table-responsive mb-3">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">18회손보통산</th>
                  <th scope="col" class="text-nowrap">25회손보통산</th>
                  <th scope="col" class="text-nowrap">18회생보통산</th>
                  <th scope="col" class="text-nowrap">25회생보통산</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_ns_18_total" data-bind="summary.ns_18_total" data-type="percent">{% if ns_18_total is not None %}{{ ns_18_total|floatformat:2 }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ns_25_total" data-bind="summary.ns_25_total" data-type="percent">{% if ns_25_total is not None %}{{ ns_25_total|floatformat:2 }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ls_18_total" data-bind="summary.ls_18_total" data-type="percent">{% if ls_18_total is not None %}{{ ls_18_total|floatformat:2 }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ls_25_total" data-bind="summary.ls_25_total" data-type="percent">{% if ls_25_total is not None %}{{ ls_25_total|floatformat:2 }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- ✅ 응당수금율 -->
          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">2-6회손보응당</th>
                  <th scope="col" class="text-nowrap">2-13회손보응당</th>
                  <th scope="col" class="text-nowrap">2-6회생보응당</th>
                  <th scope="col" class="text-nowrap">2-13회생보응당</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-nowrap"><span id="metric_ns_2_6_due" data-bind="summary.ns_2_6_due" data-type="percent">{% if ns_2_6_due %}{{ ns_2_6_due|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ns_2_13_due" data-bind="summary.ns_2_13_due" data-type="percent">{% if ns_2_13_due %}{{ ns_2_13_due|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ls_2_6_due" data-bind="summary.ls_2_6_due" data-type="percent">{% if ls_2_6_due %}{{ ls_2_6_due|intcomma }}{% else %}-{% endif %}</span></td>
                  <td class="text-nowrap"><span id="metric_ls_2_13_due" data-bind="summary.ls_2_13_due" data-type="percent">{% if ls_2_13_due %}{{ ls_2_13_due|intcomma }}{% else %}-{% endif %}</span></td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>

      <!-- ✅ 채권현황 -->
      <div class="card shadow-sm border-0 rounded-4 my-3">
        <div class="card-body p-3 p-md-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-bold" style="color:#000000;">보증보험</div>
          </div>

          <div class="table-responsive mb-3">
            <table id="suretyTable" class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">상품명</th>
                  <th scope="col" class="text-nowrap">증권번호</th>
                  <th scope="col" class="text-nowrap">가입금액</th>
                  <th scope="col" class="text-nowrap">상태</th>
                  <th scope="col" class="text-nowrap">보험가입일</th>
                  <th scope="col" class="text-nowrap">보험종료일</th>
                </tr>
              </thead>

              {# ✅ JS가 렌더링하는 영역 #}
              <tbody id="suretyTableBody">
                <tr>
                  <td class="text-nowrap text-center" colspan="5">대상자를 선택하면 보증보험 내역이 표시됩니다.</td>
                </tr>
              </tbody>

            </table>
          </div>

          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-bold" style="color:#000000;">기타채권</div>
          </div>

          <div class="table-responsive">
            <table id="otherTable" class="table table-sm align-middle mb-0 info-table">
              <thead>
                <tr>
                  <th scope="col" class="text-nowrap">상품명</th>
                  <th scope="col" class="text-nowrap">보증내용</th>
                  <th scope="col" class="text-nowrap">가입금액</th>
                  <th scope="col" class="text-nowrap">상태</th>
                  <th scope="col" class="text-nowrap">채권번호</th>
                  <th scope="col" class="text-nowrap">가입일</th>
                  <th scope="col" class="text-nowrap">비고</th>
                </tr>
              </thead>
              <tbody id="otherTableBody">
                <tr>
                  <td class="text-center text-nowrap" colspan="7">
                    대상자를 선택하면 기타채권 내역이 표시됩니다.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
      {{ block.super }}
    </div>
  </div>
</div>

<!-- 데이터업로드 카드 -->
<div class="container mt-5">
  <div class="mx-auto" style="max-width: 1100px;">
    <div class="card shadow p-4 border-0 rounded-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold mb-0" style="color:#003f7d;">데이터 업데이트</h5>
        <div class="d-flex gap-2 align-items-center">
          <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#excelUploadModal">
            엑셀업로드
          </button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0 info-table" id="depositUpdateSummaryTable">
          <thead>
            <tr>
              <th class="text-nowrap">구분</th>
              {% for p in parts %}
                <th class="text-nowrap">{{ p }}</th>
              {% endfor %}
            </tr>
          </thead>

          <tbody>
            {% for c in categories %}
              <tr>
                <td class="text-nowrap fw-semibold">{{ c }}</td>

                {% for p in parts %}
                  <td class="text-nowrap text-center">
                    {% if supported_upload_types and c in supported_upload_types %}
                      <span class="upload-date" data-upload-date data-upload-type="{{ c }}" data-part="{{ p }}">{{ upload_dates|get_item:c|get_item:p|default:"-" }}</span>
                    {% else %}
                      <span data-key="{{ c }}" data-part="{{ p }}">
                        {{ upload_dates|get_item:c|get_item:p|default:"-" }}
                      </span>
                    {% endif %}
                  </td>
                {% endfor %}

              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<!-- ✅ 엑셀 업로드 모달 -->
<div class="modal fade" id="excelUploadModal" tabindex="-1" aria-labelledby="excelUploadModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 border-0 shadow">
      <div class="modal-header bg-light">
        <h6 class="modal-title fw-bold" id="excelUploadModalLabel">엑셀 파일 업로드</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>

      <div class="modal-body">
        <form id="excelUploadForm" method="POST" enctype="multipart/form-data" action="{% url 'commission:upload_excel' %}">
          {% csrf_token %}

          <div class="mb-3">
            <label class="form-label small fw-bold">부서 선택</label>
            <select id="uploadPartSelect" name="part" class="form-select form-select-sm" required>
              <option value="">-- 선택 --</option>
              {% for p in parts %}
                <option value="{{ p }}">{{ p }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label small fw-bold">업로드 구분</label>
            <select id="uploadTypeSelect" name="upload_type" class="form-select form-select-sm" required>
              <option value="">-- 선택 --</option>
              <option value="최종지급액">최종지급액</option>
              <option value="환수지급예상">환수지급예상</option>
              <option value="보증증액">보증증액</option>
              <option value="보증보험">보증보험</option>
              <option value="기타채권">기타채권</option>
              <option value="통산생보">통산생보</option>
              <option value="통산손보">통산손보</option>
              <option value="응당생보">응당생보</option>
              <option value="응당손보">응당손보</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="excelFile" class="form-label small fw-bold">엑셀 파일 선택</label>
            <input class="form-control form-control-sm" type="file" id="excelFile" name="excel_file" accept=".xlsx,.xls" required>
          </div>

          <div class="text-end mt-4">
            <button type="submit" class="btn btn-primary btn-sm">업로드</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">취소</button>
          </div>
        </form>

        <div id="uploadResult" class="mt-3 small text-center"></div>
      </div>
    </div>
  </div>
</div>

<!-- ✅ 업로드 완료 토스트 -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1080;">
  <div id="uploadToast" class="toast align-items-center text-bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body fw-bold">✅ 업로드가 성공적으로 완료되었습니다!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<style>
  .info-table thead th{
    font-size: 0.85rem;
    font-weight: 700;
    color: #5b6b7a;
    background: #f6f8fb;
    border-bottom: 1px solid #e6edf5;
    padding: 10px 12px;
  }
  .info-table tbody td{
    font-size: 1rem;
    padding: 10px 12px;
    border-bottom: 1px solid #eef2f7;
  }

  /* ===============================
  * 채권현황(Deposit) - 테이블 스크롤/컬럼 정책
  * - 테이블 폭이 화면보다 크면 table-responsive에서 가로 스크롤
  * - 대부분 컬럼: 줄바꿈/말줄임 없음 + min-width로 폭 유지(내용 길면 테이블이 커짐)
  * - 증권번호/비고: 고정폭 + 줄바꿈 없음 + 말줄임 + title 툴팁
  * =============================== */

  /* 공통: 테이블을 내용 기준(max-content)으로 유지 → 화면이 좁으면 가로스크롤 */
  #suretyTable,
  #otherTable {
    width: max-content;
    min-width: 100%;
    table-layout: auto; /* 내용 길면 테이블이 커지도록 */
  }

  /* 공통: 기본은 줄바꿈 금지(말줄임도 기본은 없음) */
  #suretyTable th, #suretyTable td,
  #otherTable th,  #otherTable td {
    white-space: nowrap;
    word-break: keep-all;
    overflow: visible;
    text-overflow: clip;
    vertical-align: middle;
  }

  /* ---------- 보증보험(surety) 컬럼 폭 ---------- */
  /* 1) 상품명 */
  #suretyTable th:nth-child(1),
  #suretyTable td:nth-child(1) { min-width: 110px; }

  /* 2) 증권번호: 가입금액과 동일 폭(100px) + 말줄임 + 툴팁용 */
  #suretyTable th:nth-child(2),
  #suretyTable td:nth-child(2) {
    width: 100px;
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* 3) 가입금액 */
  #suretyTable th:nth-child(3),
  #suretyTable td:nth-child(3) {
    width: 100px;
    min-width: 100px;
    text-align: right;
  }

  /* 4) 상태 */
  #suretyTable th:nth-child(4),
  #suretyTable td:nth-child(4) { min-width: 80px; }

  /* 5) 보험가입일 */
  #suretyTable th:nth-child(5),
  #suretyTable td:nth-child(5) { min-width: 110px; }

  /* 6) 보험종료일 */
  #suretyTable th:nth-child(6),
  #suretyTable td:nth-child(6) { min-width: 110px; }

  /* 증권번호 셀 UX(툴팁이 있음을 암시) */
  #suretyTable td:nth-child(2) {
    cursor: help;
  }

  /* ---------- 기타채권(other) 컬럼 폭 ---------- */
  /* 1) 상품명 */
  #otherTable th:nth-child(1),
  #otherTable td:nth-child(1) { min-width: 110px; }

  /* 2) 보증내용 */
  #otherTable th:nth-child(2),
  #otherTable td:nth-child(2) { min-width: 110px; }

  /* 3) 가입금액 */
  #otherTable th:nth-child(3),
  #otherTable td:nth-child(3) {
    width: 100px;
    min-width: 100px;
    text-align: right;
  }

  /* 4) 상태 */
  #otherTable th:nth-child(4),
  #otherTable td:nth-child(4) { min-width: 80px; }

  /* 5) 채권번호 */
  #otherTable th:nth-child(5),
  #otherTable td:nth-child(5) { min-width: 110px; }

  /* 6) 가입일 */
  #otherTable th:nth-child(6),
  #otherTable td:nth-child(6) { min-width: 95px; }

  /* 7) 비고: 가입금액의 2배 정도(200px) + 말줄임 + 툴팁 */
  #otherTable th:nth-child(7),
  #otherTable td:nth-child(7) {
    width: 200px;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #otherTable td:nth-child(7) {
    cursor: help;
  }

  /* ✅ 말줄임 셀 내부 span: 툴팁 타겟(클릭/탭 영역 안정화) */
  .ellipsis-cell {
    display: block;
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* 툴팁 표시가 가능한 셀임을 UX로 암시 */
  #suretyTable td:nth-child(2),
  #otherTable td:nth-child(7) {
    cursor: pointer; /* help 보다 모바일에서 자연스러움 */
  }
</style>

{% include 'components/search_user_modal.html' with search_url='/api/accounts/search-user/' %}

<script type="module" src="{% static 'js/commission/deposit_home.js' %}{% if STATIC_VERSION %}?v={{ STATIC_VERSION }}{% endif %}"></script>
{% endblock %}

