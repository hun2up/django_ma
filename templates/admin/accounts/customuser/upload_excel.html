{# django_ma/templates/admin/accounts/customuser/upload__excel.html #}
{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div class="container mt-4" style="max-width: 640px;">

  <h3 class="fw-bold mb-4 text-center">사용자 엑셀 업로드</h3>

  {% if messages %}
  <div class="mb-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} text-center mb-2">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="card p-4 rounded-4">
    <form method="post" enctype="multipart/form-data" id="excelUploadForm">
      {% csrf_token %}
      <div class="mb-3">
        {{ form.as_p }}
      </div>

      <button type="submit" class="btn btn-primary w-100 fw-bold">
        업로드 시작
      </button>
    </form>

    <div class="text-center mt-4">
      <a href="{% url 'admin:accounts_customuser_changelist' %}"
         class="btn btn-outline-secondary">
        이전으로 돌아가기
      </a>
    </div>
  </div>

  {% if task_id %}
  <!--
    진행률 표시 박스
    - JS(admin_upload_progress.js)가 data-* 속성을 읽어 polling
  -->
  <div class="mt-4"
       id="uploadProgressBox"
       data-task-id="{{ task_id|escape }}"
       data-progress-url="{% url 'accounts:accounts_upload_progress' %}">
    <div class="card p-3 rounded-4">
      <div class="d-flex justify-content-between mb-2">
        <strong>처리 진행률</strong>
        <span id="progressStatusText" class="small text-muted">대기 중...</span>
      </div>

      <div class="progress" style="height: 20px;">
        <div id="progressBar" class="progress-bar" style="width: 0%;">0%</div>
      </div>

      <div id="progressErrorText" class="text-danger mt-2"></div>

      <div class="mt-3">
        <a id="resultDownloadBtn"
           class="btn btn-success disabled"
           href="#"
           aria-disabled="true">
          결과 다운로드
        </a>
      </div>
    </div>
  </div>
  {% endif %}

</div>

{% if task_id %}
<script src="{% static 'js/accounts/admin_upload_progress.js' %}?v={{ STATIC_VER|default:'1' }}"></script>
{% endif %}
{% endblock %}
