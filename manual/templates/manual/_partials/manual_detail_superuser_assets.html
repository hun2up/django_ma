<!-- django_ma/manual/templates/manual/_partials/manual_detail_superuser_assets.html -->
<!-- -------------------------------------------------------------------------
  Manual Detail Superuser Assets (FINAL)
  - superuser 전용으로만 로드되는 리소스 묶음
  - 구성:
    1) CSRF token form (JS가 토큰 읽기)
    2) Image Viewer modal (원본 이미지 전체보기)
    3) Block Add/Edit modal (이미지 + Quill 편집 + 첨부 업로드)
    4) Quill CDN (CSS/JS)
    5) Manual shared utilities (있으면 선로딩)
  - 기존 기능 영향 없이 "역할 단위로" 정리
--------------------------------------------------------------------------- -->

{% load static %}

<!-- =========================================================
     1) CSRF token (JS에서 읽기 전용)
========================================================== -->
<form id="manualBlockCsrfForm" class="d-none">{% csrf_token %}</form>

<!-- =========================================================
     2) Image Viewer Modal
     - 블록 이미지 클릭 시 원본을 fullscreen으로 표시
========================================================== -->
<div class="modal fade" id="manualImageViewer" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0">
        <button type="button"
                class="btn-close btn-close-white ms-auto"
                data-bs-dismiss="modal"
                aria-label="닫기"></button>
      </div>
      <div class="modal-body d-flex align-items-center justify-content-center">
        <img id="manualViewerImg" src="" alt="full image" class="manual-viewer-img">
      </div>
    </div>
  </div>
</div>

<!-- =========================================================
     3) Block Add/Edit Modal
     - add: section_id 필요 (JS state.currentSectionId)
     - edit: block_id 필요 (JS state.editingBlockId)
     - data-* URL은 JS에서 읽음 (ID/키 변경 금지)
========================================================== -->
<div class="modal fade"
     id="manualBlockModal"
     tabindex="-1"
     aria-hidden="true"
     data-add-url="{% url 'manual:manual_block_add_ajax' %}"
     data-update-url="{% url 'manual:manual_block_update_ajax' %}"
     data-attach-upload-url="{% url 'manual:manual_block_attachment_upload_ajax' %}"
     data-manual-id="{{ m.id }}">

  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content manual-block-modal">

      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title fw-bold manual-block-modal-title" id="manualBlockModalTitle">
          내용 추가
        </h5>
        <button type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="닫기"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">

        <!-- 오류 표시 영역 (JS가 show/hide) -->
        <div class="alert alert-danger py-2 d-none" id="manualBlockError"></div>

        <!-- =========================
             3-1) Image upload + preview
             - edit 모드에서 기존 이미지가 있으면:
               preview 표시 + "기존 이미지 삭제" 체크 노출
        ========================== -->
        <div class="mb-3">
          <label class="form-label fw-bold" for="manualBlockImageInput">이미지</label>
          <input type="file"
                 class="form-control"
                 id="manualBlockImageInput"
                 accept="image/*">

          <!-- Preview -->
          <div class="mt-2 border rounded-3 p-2 bg-light d-none" id="manualBlockImagePreviewWrap">
            <img id="manualBlockImagePreview"
                 src=""
                 alt="preview"
                 class="manual-block-preview-img">
          </div>

          <!-- 기존 이미지 삭제(편집 시에만 노출) -->
          <div class="form-check mt-2 d-none" id="manualBlockRemoveImageWrap">
            <input class="form-check-input" type="checkbox" value="1" id="manualBlockRemoveImage">
            <label class="form-check-label" for="manualBlockRemoveImage">기존 이미지 삭제</label>
          </div>
        </div>

        <!-- =========================
             3-2) Quill attachment input
             - Quill 툴바의 "첨부" 버튼 클릭 시 트리거되는 hidden file input
        ========================== -->
        <input type="file" id="manualQuillAttachInput" class="d-none">

        <!-- =========================
             3-3) Quill editor (Text)
        ========================== -->
        <label class="form-label fw-bold">텍스트</label>
        <div id="manualQuillEditor" class="manual-quill-editor"></div>

        <div class="form-text mt-2">
          📎 첨부 버튼으로 파일을 업로드하면 본문에 링크가 자동 삽입됩니다.
          (새 블록은 먼저 저장 후 첨부 가능)
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
        <button type="button" class="btn btn-primary" id="btnManualBlockSave">저장</button>
      </div>

    </div>
  </div>
</div>

<!-- =========================================================
     4) Quill CDN
     - Quill은 window.Quill 전역으로 제공됨
========================================================== -->
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<!-- =========================================================
     5) Manual Shared Utilities (선로딩)
     - window.ManualShared 제공(있을 경우)
========================================================== -->
<script src="{% static 'js/manual/_shared.js' %}"></script>

<!-- =========================================================
     6) (Legacy) 기존 블록 편집/첨부 로직
     - 현재 프로젝트가 신규 모듈(index.js)로 완전히 전환된 상태라면 제거 가능
     - 단, 전환 중이면 유지(혼용 방지 위해 실제 사용 여부 확인 필요)
========================================================== -->
