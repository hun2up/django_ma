<!-- django_ma/manual/templates/manual/_partials/manual_detail_superuser_assets.html -->
<!-- -------------------------------------------------------------------------
  Manual Detail Superuser Assets
  - CSRF form / Viewer modal / Block modal / Quill CDN / admin JS 로딩
  - 기존 기능 영향 없이 그대로 분리
--------------------------------------------------------------------------- -->

{% load static %}
<form id="manualBlockCsrfForm" class="d-none">{% csrf_token %}</form>

{# 이미지 원본 팝업 모달 #}
<div class="modal fade" id="manualImageViewer" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0">
        <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex align-items-center justify-content-center">
        <img id="manualViewerImg" src="" alt="full image" class="manual-viewer-img">
      </div>
    </div>
  </div>
</div>

{# 블록 add/edit 모달 #}
<div class="modal fade"
     id="manualBlockModal"
     tabindex="-1"
     aria-hidden="true"
     data-add-url="{% url 'manual:manual_block_add_ajax' %}"
     data-update-url="{% url 'manual:manual_block_update_ajax' %}"
     data-attach-upload-url="{% url 'manual:manual_block_attachment_upload_ajax' %}"
     data-manual-id="{{ m.id }}">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content manual-block-modal">
      <div class="modal-header">
        <h5 class="modal-title fw-bold manual-block-modal-title" id="manualBlockModalTitle">내용 추가</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="alert alert-danger py-2 d-none" id="manualBlockError"></div>

        {# 이미지 업로드 + 미리보기 #}
        <div class="mb-3">
          <label class="form-label fw-bold">이미지</label>
          <input type="file" class="form-control" id="manualBlockImageInput" accept="image/*">

          <div class="mt-2 border rounded-3 p-2 bg-light d-none" id="manualBlockImagePreviewWrap">
            <img id="manualBlockImagePreview" src="" alt="preview" class="manual-block-preview-img">
          </div>

          <div class="form-check mt-2 d-none" id="manualBlockRemoveImageWrap">
            <input class="form-check-input" type="checkbox" value="1" id="manualBlockRemoveImage">
            <label class="form-check-label" for="manualBlockRemoveImage">기존 이미지 삭제</label>
          </div>
        </div>

        {# Quill 첨부용 hidden input #}
        <input type="file" id="manualQuillAttachInput" class="d-none">

        {# 텍스트(Quill) #}
        <label class="form-label fw-bold">텍스트</label>
        <div id="manualQuillEditor" class="manual-quill-editor"></div>
        <div class="form-text mt-2">
          📎 첨부 버튼으로 파일을 업로드하면 본문에 링크가 자동 삽입됩니다.
          (새 블록은 먼저 저장 후 첨부 가능)
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
        <button type="button" class="btn btn-primary" id="btnManualBlockSave">저장</button>
      </div>
    </div>
  </div>
</div>

{# Quill (외부 CDN) #}
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

{# ✅ 공통 유틸(있을 경우) - 기능 영향 없이 선로딩 #}
<script src="{% static 'js/manual/_shared.js' %}"></script>

{# 기존 블록 편집/첨부 로직 #}
<script src="{% static 'js/manual/manual_detail_block.js' %}?v=20260112_attach_01"></script>
