{% extends 'base.html' %}
{% load static %}
{% block title %}ê¶Œí•œê´€ë¦¬{% endblock %}

{% block content %}
  {% if user.grade not in 'superuser main_admin' %}
    <div class="alert alert-danger">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</div>
  {% endif %}

  <h3 class="text-center fw-bold mb-4" style="color:#003f7d;">ê¶Œí•œê´€ë¦¬ í˜ì´ì§€</h3>

  {% if user.grade == 'superuser' %}
  <!-- ğŸ”¹ ë¶€ì„œ ì„ íƒ í¼ -->
  <div class="card shadow p-3 border-0 rounded-4 mb-3">
    <form method="get" class="d-flex align-items-end gap-2 flex-wrap">
      <div>
        <label class="form-label mb-1">ë¶€ì„œ</label>
        <select name="part" class="form-select form-select-sm" style="width:140px;">
          <option value="">ì„ íƒ</option>
          {% for p in parts %}
            <option value="{{ p }}" {% if selected_part == p %}selected{% endif %}>{{ p }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="form-label mb-1 d-none d-md-block">&nbsp;</label>
        <button type="submit" class="btn btn-outline-primary btn-sm px-3">ì¡°íšŒ</button>
      </div>
    </form>
  </div>
  {% endif %}

  <!-- ğŸ”¹ ì—‘ì…€ ì—…ë¡œë“œ -->
  <div class="d-flex justify-content-end mb-3 gap-2">
    <form id="excelUploadForm" method="post" enctype="multipart/form-data" action="{% url 'partner:upload_grades_excel' %}">
      {% csrf_token %}
      <input type="file" name="excel_file" id="excelFile" accept=".xlsx,.xls" hidden>
      <button type="button" class="btn btn-success btn-sm" id="uploadBtn">
        <i class="bi bi-file-earmark-excel"></i> ì—‘ì…€ ì—…ë¡œë“œ
      </button>
    </form>
  </div>

  <!-- ğŸ”¹ ë°ì´í„° í…Œì´ë¸” -->
  <div class="card shadow p-3 border-0 rounded-4">
    <div class="table-responsive">
      <table class="table table-striped align-middle" id="mainTable">
        <thead class="table-light text-center align-middle">
          <tr>
            <th>ë¶€ì„œ</th>
            <th>ì§€ì </th>
            <th>íŒ€A</th>
            <th>íŒ€B</th>
            <th>íŒ€C</th>
            <th>ì„±ëª…</th>
            <th>ì‚¬ë²ˆ</th>
            <th>ì§ê¸‰</th>
            <th>ë“±ê¸‰</th>
          </tr>
        </thead>
        <tbody>
          {% if users %}
            {% for u in users %}
            <tr>
              <td>{{ u.part|default:"-" }}</td>
              <td>{{ u.branch|default:"-" }}</td>
              <td>{{ u.team_a|default:"-" }}</td>
              <td>{{ u.team_b|default:"-" }}</td>
              <td>{{ u.team_c|default:"-" }}</td>
              <td>{{ u.name|default:"-" }}</td>
              <td>{{ u.user.id|default:"-" }}</td>
              <td>{{ u.position|default:"-" }}</td>
              <td>{{ u.level|default:"-" }}</td>
            </tr>
            {% endfor %}
          {% else %}
            <!-- âœ… ë°ì´í„°ê°€ ì—†ì„ ë•Œë„ 9ì—´ ìœ ì§€ (DataTables ê²½ê³  ë°©ì§€) -->
            <tr>
              <td colspan="9" class="text-center text-muted py-3">
                {{ empty_message|default:"ì¶”ê°€ëœ ì¤‘ê°„ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤. ì¤‘ê°„ê´€ë¦¬ì ì¶”ê°€ëŠ” ë¶€ì„œì¥ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”." }}
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- âœ… JS ì—°ê²° -->
  <script src="{% static 'js/partner/manage_grades.js' %}"></script>
{% endblock %}
