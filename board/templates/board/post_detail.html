<!--django_ma/board/templates/board/post_detail.html-->
{% extends "base.html" %}
{% load static %}

{% block title %}업무요청 상세보기{% endblock %}

{% block content %}
<div class="container mt-5">

  {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show text-center" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  <div class="mx-auto" style="max-width: 700px;">

    <!-- 🔹 카드 시작 -->
    <div class="card shadow p-4 border-0 rounded-4">

      <!-- 🔸 제목 + 작성일자 -->
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="fw-bold mb-0" style="color:#003f7d;">{{ post.title }}</h5>
        <p class="text-muted small mb-0">{{ post.created_at|date:"Y-m-d H:i" }}</p>
      </div>

      <!-- 🔸 구분선 -->
      <hr class="mb-4 mt-2">

      <!-- 🔸 필드 요약 정보 (1줄 3개 배치) -->
      <div class="mb-3">
        <div class="row">
          <!-- 구분 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">구분:</strong>
            {% if post.category and post.category != "선택" %}
              {{ post.category }}
            {% else %}
              -
            {% endif %}
          </div>

          <!-- 대상자 성명 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">성명(대상자):</strong>
            {{ post.fa|default:"-" }}
          </div>

          <!-- 대상자 사번 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">사번(대상자):</strong>
            {{ post.code|default:"-" }}
          </div>

          <!-- 요청자 소속 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">소속(요청자):</strong>
            {{ post.user_branch }}
          </div>
          
          <!-- 요청자 성명 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">성명(요청자):</strong>
            {{ post.user_name }}
          </div>

          <!-- 요청자 사번 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">요청자(사번):</strong>
            {{ post.user_id }}
          </div>

        </div>
      </div>

      <!-- 🔸 요청 내용 -->
      <hr class="my-3">
      <div class="mb-3">
        <strong class="text-muted">요청 내용:</strong>
        <p class="fs-6 mt-2" style="white-space: pre-wrap;">{{ post.content }}</p>
      </div>

      <!-- 🔸 담당자, 상태, 상태변경일 -->
      <hr class="my-3">
      <div class="mb-3">
        <div class="row align-items-center">
          <!-- 담당자 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">담당자:</strong>
            {% if is_superuser %}
              <form method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="action_type" value="handler">
                <select name="handler" class="form-select form-select-sm d-inline-block" style="width:auto;">
                  <option value="선택" {% if not post.handler %}selected{% endif %}>선택</option>
                  {% for h in handlers %}
                    <option value="{{ h }}" {% if post.handler == h %}selected{% endif %}>{{ h }}</option>
                  {% endfor %}
                </select>
                <button type="submit" class="btn btn-sm btn-primary">변경</button>
              </form>
            {% else %}
              {{ post.handler|default:"-" }}
            {% endif %}
          </div>

          <!-- 상태 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">상태:</strong>
            {% if is_superuser %}
              <form method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="action_type" value="status">
                <select name="status" class="form-select form-select-sm d-inline-block" style="width:auto;">
                  {% for s in status_choices %}
                    <option value="{{ s }}" {% if post.status == s %}selected{% endif %}>{{ s }}</option>
                  {% endfor %}
                </select>
                <button type="submit" class="btn btn-sm btn-primary">변경</button>
              </form>
            {% else %}
              <span
                style="
                  {% if post.status == '확인중' %}color:orange;
                  {% elif post.status == '진행중' %}color:green;
                  {% elif post.status == '보완요청' %}color:red;
                  {% elif post.status == '완료' %}color:black;
                  {% elif post.status == '반려' %}color:gray;
                  {% endif %}
                  font-weight:600;
                ">
                {{ post.status }}
              </span>
            {% endif %}
          </div>

          <!-- 상태변경일 -->
          <div class="col-md-4 mb-2">
            <strong class="text-muted">상태변경일:</strong>
            {{ post.status_updated_at|date:"Y-m-d H:i" }}
          </div>
        </div>
      </div>


      <!-- 🔸 버튼 영역 -->
      <div class="d-flex justify-content-between mt-4">
        <a href="{% url 'post_list' %}" class="btn btn-outline-secondary">← 목록으로</a>
        <a href="{% url 'home' %}" class="btn btn-dark">메인으로</a>
      </div>

    </div>
    <!-- 🔹 카드 끝 -->

  </div>
</div>
{% endblock %}
