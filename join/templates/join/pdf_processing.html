{% extends "base.html" %}

{% block title %}PDF 생성 중{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="mx-auto" style="max-width: 600px;">
    <div class="card shadow p-5 border-0 rounded-4 text-center">
      <h3 class="mb-4" style="font-family:'Noto Sans KR', sans-serif; color:#003f7d; font-weight:700;">
        PDF 생성 중입니다...
      </h3>
      <p class="lead text-muted mb-4">
        위촉서류를 준비하고 있습니다. <br>
        완료되면 자동으로 다운로드됩니다.
      </p>

      <div class="progress" style="height: 20px;">
        <div class="progress-bar progress-bar-striped progress-bar-animated"
             role="progressbar" style="width: 100%;" aria-valuenow="100"
             aria-valuemin="0" aria-valuemax="100">
          처리 중...
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <a href="{% url 'home' %}" class="btn btn-outline-dark px-4 py-2 fw-semibold">
        메인으로 돌아가기
      </a>
    </div>
  </div>
</div>

<script>
  const taskId = "{{ task_id }}";
  const checkStatus = async () => {
    const res = await fetch(`/join/status/${taskId}/`);
    const data = await res.json();
    if (data.status === 'SUCCESS' && data.pdf_ready) {
      window.location.href = `/join/download/${taskId}/`;
    } else if (data.status === 'FAILURE') {
      alert('PDF 생성에 실패했습니다.');
    } else {
      setTimeout(checkStatus, 2000);
    }
  };
  checkStatus();
</script>
{% endblock %}
